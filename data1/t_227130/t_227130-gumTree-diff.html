<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<title>Diff result</title>
<style type="text/css">
body { width: 100%; font-size: 10pt; }
h1 { font-size: 125%; }
div.content { font-family: Verdana, "DejaVu Sans Condensed", "Liberation Sans","Nimbus Sans L", Helvetica, sans-serif; margin : 1em auto; width: 100%; }
div.left { float: left; width: 48%; padding: 1em; }
div.right { float: right; width: 48%; padding: 1em; }
div.code { font-family: "Liberation Mono", "Courrier New", monospace; border:1px solid black;}
div.clear { clear: both; }
span.del { background-color : red; font-weight: normal; font-style: normal;}
span.add { background-color : lightgreen; font-weight: bold; font-style: normal;}
span.upd { background-color : orange; font-weight: bold; font-style: italic;}
span.id { background-color : white; font-weight: normal; font-style: normal;}
span.mv { background-color : yellow; font-weight: normal; font-style: normal;}
</style></head><body><div class="content"><div class="left">
<h1>left_Transaction_1.37.java</h1>
<div class="code">
<div class="id">
package org.tigris.scarab.om;<br/>
<br/>
/* ================================================================<br/>
 * Copyright (c) 2000-2002 CollabNet.  All rights reserved.<br/>
 * <br/>
 * Redistribution and use in source and binary forms, with or without<br/>
 * modification, are permitted provided that the following conditions are<br/>
 * met:<br/>
 * <br/>
 * 1. Redistributions of source code must retain the above copyright<br/>
 * notice, this list of conditions and the following disclaimer.<br/>
 * <br/>
 * 2. Redistributions in binary form must reproduce the above copyright<br/>
 * notice, this list of conditions and the following disclaimer in the<br/>
 * documentation and/or other materials provided with the distribution.<br/>
 * <br/>
 * 3. The end-user documentation included with the redistribution, if<br/>
 * any, must include the following acknowlegement: "This product includes<br/>
 * software developed by Collab.Net &lt;http://www.Collab.Net/&gt;."<br/>
 * Alternately, this acknowlegement may appear in the software itself, if<br/>
 * and wherever such third-party acknowlegements normally appear.<br/>
 * <br/>
 * 4. The hosted project names must not be used to endorse or promote<br/>
 * products derived from this software without prior written<br/>
 * permission. For written permission, please contact info@collab.net.<br/>
 * <br/>
 * 5. Products derived from this software may not use the "Tigris" or <br/>
 * "Scarab" names nor may "Tigris" or "Scarab" appear in their names without <br/>
 * prior written permission of Collab.Net.<br/>
 * <br/>
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED<br/>
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF<br/>
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.<br/>
 * IN NO EVENT SHALL COLLAB.NET OR ITS CONTRIBUTORS BE LIABLE FOR ANY<br/>
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL<br/>
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE<br/>
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<br/>
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER<br/>
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR<br/>
 * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF<br/>
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<br/>
 *<br/>
 * ====================================================================<br/>
 * <br/>
 * This software consists of voluntary contributions made by many<br/>
 * individuals on behalf of Collab.Net.<br/>
 */ <br/>
<br/>
import java.util.Date;<br/>
import java.util.List;<br/>
import java.util.LinkedList;<br/>
import java.util.Iterator;<br/>
<br/>
import org.apache.torque.TorqueException;<br/>
import org.apache.torque.util.Criteria; <br/>
import org.apache.torque.om.NumberKey;<br/>
<br/>
import org.apache.fulcrum.template.TemplateContext;<br/>
import org.apache.fulcrum.template.DefaultTemplateContext;<br/>
import org.apache.fulcrum.template.TemplateEmail;<br/>
<br/>
import org.apache.turbine.Turbine;<br/>
import org.apache.torque.om.Persistent;<br/>
<br/>
import org.tigris.scarab.util.ScarabException;<br/>
import org.tigris.scarab.util.Email;<br/>
import org.tigris.scarab.services.cache.ScarabCache;<br/>
<br/>
/** <br/>
  * The skeleton for this class was autogenerated by Torque on:<br/>
  *<br/>
  * [Wed Feb 28 16:36:26 PST 2001]<br/>
  *<br/>
  * You should add additional methods to this class to meet the<br/>
  * application requirements.  This class will only be generated as<br/>
  * long as it does not already exist in the output directory.<br/>
<br/>
  */<br/>
public class Transaction <br/>
    extends BaseTransaction<br/>
    implements Persistent<br/>
{<br/>
    private static final String GET_ACTIVITY_LIST = <br/>
        "getActivityList";<br/>
<br/>
    /**<br/>
     * The Attachment associated with this Transaction<br/>
        // FIXME: (JSS) is this needed?<br/>
     */<br/>
    private Attachment aAttachment = null;                 <br/>
<br/>
    /**<br/>
     * Populates a new transaction object.<br/>
     */<br/>
    public void create(NumberKey typeId, ScarabUser user, Attachment attachment)<br/>
        throws Exception<br/>
    {<br/>
        if (attachment != null &amp;&amp; attachment.getAttachmentId() == null) <br/>
        {<br/>
            String mesg = <br/>
                "Attachment must be saved before starting transaction";<br/>
            throw new ScarabException(mesg);<br/>
        }<br/>
        setTypeId(typeId);<br/>
        setCreatedBy(user.getUserId());<br/>
        setCreatedDate(new Date());<br/>
        if (attachment != null)<br/>
        {<br/>
            setAttachment(attachment);<br/>
        }<br/>
        save();<br/>
    }<br/>
<br/>
    /**<br/>
     * Returns a list of Activity objects associated with this Transaction.<br/>
     */<br/>
    public List getActivityList() throws Exception<br/>
    {<br/>
        List result = null;<br/>
        Object obj = ScarabCache.get(this, GET_ACTIVITY_LIST); <br/>
        if ( obj == null ) <br/>
        {        <br/>
            Criteria crit = new Criteria()<br/>
                .add(ActivityPeer.TRANSACTION_ID, getTransactionId());<br/>
            result = ActivityPeer.doSelect(crit);<br/>
            ScarabCache.put(result, this, GET_ACTIVITY_LIST);<br/>
        }<br/>
        else <br/>
        {<br/>
            result = (List)obj;<br/>
        }<br/>
        return result;<br/>
    }<br/>
<br/>
    /** <br/>
        Sends email to the users associated with the issue.<br/>
        That is associated with this transaction.<br/>
        If no subject and template specified, assume modify issue action.<br/>
        throws Exception<br/>
    */<br/>
    public boolean sendEmail( TemplateContext context, Issue issue, <br/>
                           String subject, String template )<br/>
         throws Exception<br/>
    {<br/>
        if ( context == null ) <br/>
        {<br/>
            context = new DefaultTemplateContext();<br/>
        }<br/>
        <br/>
        // add data to context<br/>
        context.put("issue", issue);<br/>
        // FIXME: (JSS) is this needed?<br/>
        context.put("attachment", aAttachment);<br/>
        context.put("activityList", getActivityList());<br/>
        <br/>
        String fromUser = "scarab.email.modifyissue";<br/>
        <br/>
        if (subject == null)<br/>
        {<br/>
            subject = "[" + issue.getModule().getRealName().toUpperCase() + <br/>
                "] Issue #" + issue.getUniqueId() + " modified";<br/>
        }<br/>
        <br/>
        if (template == null)<br/>
        {<br/>
            template = Turbine.getConfiguration().<br/>
                getString("scarab.email.modifyissue.template");<br/>
        }<br/>
        <br/>
        // Get users for "to" field of email<br/>
        List toUsers = new LinkedList();<br/>
        <br/>
        // Then add users who are assigned to "email-to" attributes<br/>
        List users = issue.getUsersToEmail(AttributePeer.EMAIL_TO);<br/>
        Iterator iter = users.iterator();<br/>
        while ( iter.hasNext() ) <br/>
        {<br/>
            toUsers.add(iter.next());<br/>
        }<br/>
        <br/>
        // add users to cc field of email<br/>
        List ccUsers = null;<br/>
        users = issue.getUsersToEmail(AttributePeer.CC_TO);<br/>
        if (users != null)<br/>
        {<br/>
            ccUsers = new LinkedList();<br/>
            iter = users.iterator();<br/>
            while ( iter.hasNext() ) <br/>
            {<br/>
                ccUsers.add(iter.next());<br/>
            }<br/>
        }<br/>
        <br/>
        return Email.sendEmail( context, issue.getModule(), fromUser, toUsers,<br/>
                                ccUsers, subject, template);<br/>
    }<br/>
<br/>
    /** <br/>
        If no subject and template have been specified,<br/>
        Pass null arguments to the email method to specify  <br/>
        Using default values for modify issue.<br/>
        @throws Exception<br/>
    */<br/>
    public boolean sendEmail(TemplateContext context, Issue issue)<br/>
        throws Exception<br/>
    {<br/>
        return sendEmail(context, issue, null, null);<br/>
    }<br/>
    <br/>
    public boolean sendEmail(Issue issue)<br/>
        throws Exception<br/>
    {<br/>
        return sendEmail(null, issue, null, null);<br/>
    }<br/>
    <br/>
    <br/>
    /** <br/>
        Convenience method for emails that require no extra context info. <br/>
        @throws Exception<br/>
    */<br/>
    public boolean sendEmail(Issue issue, String subject, String template)<br/>
        throws Exception<br/>
    {<br/>
        return sendEmail(null, issue, subject, template);<br/>
    }<br/>
}<br/>
</div>
</div>
</div>
<div class="right">
<h1>right_Transaction_1.38.java</h1>
<div class="code">
<div class="id">
package org.tigris.scarab.om;<br/>
<br/>
/* ================================================================<br/>
 * Copyright (c) 2000-2002 CollabNet.  All rights reserved.<br/>
 * <br/>
 * Redistribution and use in source and binary forms, with or without<br/>
 * modification, are permitted provided that the following conditions are<br/>
 * met:<br/>
 * <br/>
 * 1. Redistributions of source code must retain the above copyright<br/>
 * notice, this list of conditions and the following disclaimer.<br/>
 * <br/>
 * 2. Redistributions in binary form must reproduce the above copyright<br/>
 * notice, this list of conditions and the following disclaimer in the<br/>
 * documentation and/or other materials provided with the distribution.<br/>
 * <br/>
 * 3. The end-user documentation included with the redistribution, if<br/>
 * any, must include the following acknowlegement: "This product includes<br/>
 * software developed by Collab.Net &lt;http://www.Collab.Net/&gt;."<br/>
 * Alternately, this acknowlegement may appear in the software itself, if<br/>
 * and wherever such third-party acknowlegements normally appear.<br/>
 * <br/>
 * 4. The hosted project names must not be used to endorse or promote<br/>
 * products derived from this software without prior written<br/>
 * permission. For written permission, please contact info@collab.net.<br/>
 * <br/>
 * 5. Products derived from this software may not use the "Tigris" or <br/>
 * "Scarab" names nor may "Tigris" or "Scarab" appear in their names without <br/>
 * prior written permission of Collab.Net.<br/>
 * <br/>
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED<br/>
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF<br/>
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.<br/>
 * IN NO EVENT SHALL COLLAB.NET OR ITS CONTRIBUTORS BE LIABLE FOR ANY<br/>
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL<br/>
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE<br/>
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<br/>
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER<br/>
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR<br/>
 * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF<br/>
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<br/>
 *<br/>
 * ====================================================================<br/>
 * <br/>
 * This software consists of voluntary contributions made by many<br/>
 * individuals on behalf of Collab.Net.<br/>
 */ <br/>
<br/>
import java.util.Date;<br/>
import java.util.List;<br/>
import java.util.LinkedList;<br/>
import java.util.Iterator;<br/>
<br/>
import org.apache.torque.TorqueException;<br/>
import org.apache.torque.util.Criteria; <br/>
import org.apache.torque.om.NumberKey;<br/>
<br/>
import org.apache.fulcrum.template.TemplateContext;<br/>
import org.apache.fulcrum.template.DefaultTemplateContext;<br/>
import org.apache.fulcrum.template.TemplateEmail;<br/>
<br/>
import org.apache.turbine.Turbine;<br/>
import org.apache.torque.om.Persistent;<br/>
<br/>
import org.tigris.scarab.util.ScarabException;<br/>
import org.tigris.scarab.util.Email;<br/>
import org.tigris.scarab.services.cache.ScarabCache;<br/>
<br/>
/** <br/>
  * The skeleton for this class was autogenerated by Torque on:<br/>
  *<br/>
  * [Wed Feb 28 16:36:26 PST 2001]<br/>
  *<br/>
  * You should add additional methods to this class to meet the<br/>
  * application requirements.  This class will only be generated as<br/>
  * long as it does not already exist in the output directory.<br/>
<br/>
  */<br/>
public class Transaction <br/>
    extends BaseTransaction<br/>
    implements Persistent<br/>
{<br/>
    private static final String GET_ACTIVITY_LIST = <br/>
        "getActivityList";<br/>
<br/>
    /**<br/>
     * The Attachment associated with this Transaction<br/>
        // FIXME: (JSS) is this needed?<br/>
     */<br/>
    private Attachment aAttachment = null;                 <br/>
<br/>
    <span class="add"><span class="add">/**<br/>
     * Populates a new transaction object.<br/>
     */</span><br/>
    <span class="add">public</span> <span class="add">void</span> <span class="add">create</span>(<span class="add"><span class="add"><span class="add">NumberKey</span></span> <span class="add">typeId</span></span>, <span class="add"><span class="add"><span class="add">ScarabUser</span></span> <span class="add">user</span></span>)<br/>
        throws <span class="add">Exception</span><br/>
    <span class="add">{<br/>
        <span class="add"><span class="add"><span class="add">create</span>(<span class="add">typeId</span>, <span class="add">user</span>, <span class="add">null</span>)</span>;</span><br/>
    }</span></span><br/>
<br/>
    /**<br/>
     * Populates a new transaction object.<br/>
     */<br/>
    public void create(NumberKey typeId, ScarabUser user, Attachment attachment)<br/>
        throws Exception<br/>
    {<br/>
        if (attachment != null &amp;&amp; attachment.getAttachmentId() == null) <br/>
        {<br/>
            String mesg = <br/>
                "Attachment must be saved before starting transaction";<br/>
            throw new ScarabException(mesg);<br/>
        }<br/>
        setTypeId(typeId);<br/>
        setCreatedBy(user.getUserId());<br/>
        setCreatedDate(new Date());<br/>
        if (attachment != null)<br/>
        {<br/>
            setAttachment(attachment);<br/>
        }<br/>
        save();<br/>
    }<br/>
<br/>
    /**<br/>
     * Returns a list of Activity objects associated with this Transaction.<br/>
     */<br/>
    public List getActivityList() throws Exception<br/>
    {<br/>
        List result = null;<br/>
        Object obj = ScarabCache.get(this, GET_ACTIVITY_LIST); <br/>
        if ( obj == null ) <br/>
        {        <br/>
            Criteria crit = new Criteria()<br/>
                .add(ActivityPeer.TRANSACTION_ID, getTransactionId());<br/>
            result = ActivityPeer.doSelect(crit);<br/>
            ScarabCache.put(result, this, GET_ACTIVITY_LIST);<br/>
        }<br/>
        else <br/>
        {<br/>
            result = (List)obj;<br/>
        }<br/>
        return result;<br/>
    }<br/>
<br/>
    /** <br/>
        Sends email to the users associated with the issue.<br/>
        That is associated with this transaction.<br/>
        If no subject and template specified, assume modify issue action.<br/>
        throws Exception<br/>
    */<br/>
    public boolean sendEmail( TemplateContext context, Issue issue, <br/>
                           String subject, String template )<br/>
         throws Exception<br/>
    {<br/>
        if ( context == null ) <br/>
        {<br/>
            context = new DefaultTemplateContext();<br/>
        }<br/>
        <br/>
        // add data to context<br/>
        context.put("issue", issue);<br/>
        // FIXME: (JSS) is this needed?<br/>
        context.put("attachment", aAttachment);<br/>
        context.put("activityList", getActivityList());<br/>
        <br/>
        String fromUser = "scarab.email.modifyissue";<br/>
        <br/>
        if (subject == null)<br/>
        {<br/>
            subject = "[" + issue.getModule().getRealName().toUpperCase() + <br/>
                "] Issue #" + issue.getUniqueId() + " modified";<br/>
        }<br/>
        <br/>
        if (template == null)<br/>
        {<br/>
            template = Turbine.getConfiguration().<br/>
                getString("scarab.email.modifyissue.template");<br/>
        }<br/>
        <br/>
        // Get users for "to" field of email<br/>
        List toUsers = new LinkedList();<br/>
        <br/>
        // Then add users who are assigned to "email-to" attributes<br/>
        List users = issue.getUsersToEmail(AttributePeer.EMAIL_TO);<br/>
        Iterator iter = users.iterator();<br/>
        while ( iter.hasNext() ) <br/>
        {<br/>
            toUsers.add(iter.next());<br/>
        }<br/>
        <br/>
        // add users to cc field of email<br/>
        List ccUsers = null;<br/>
        users = issue.getUsersToEmail(AttributePeer.CC_TO);<br/>
        if (users != null)<br/>
        {<br/>
            ccUsers = new LinkedList();<br/>
            iter = users.iterator();<br/>
            while ( iter.hasNext() ) <br/>
            {<br/>
                ccUsers.add(iter.next());<br/>
            }<br/>
        }<br/>
        <br/>
        return Email.sendEmail( context, issue.getModule(), fromUser, toUsers,<br/>
                                ccUsers, subject, template);<br/>
    }<br/>
<br/>
    /** <br/>
        If no subject and template have been specified,<br/>
        Pass null arguments to the email method to specify  <br/>
        Using default values for modify issue.<br/>
        @throws Exception<br/>
    */<br/>
    public boolean sendEmail(TemplateContext context, Issue issue)<br/>
        throws Exception<br/>
    {<br/>
        return sendEmail(context, issue, null, null);<br/>
    }<br/>
    <br/>
    public boolean sendEmail(Issue issue)<br/>
        throws Exception<br/>
    {<br/>
        return sendEmail(null, issue, null, null);<br/>
    }<br/>
    <br/>
    <br/>
    /** <br/>
        Convenience method for emails that require no extra context info. <br/>
        @throws Exception<br/>
    */<br/>
    public boolean sendEmail(Issue issue, String subject, String template)<br/>
        throws Exception<br/>
    {<br/>
        return sendEmail(null, issue, subject, template);<br/>
    }<br/>
}<br/>
</div>
</div>
</div>
<div class="clear"></div>
</div>
</body>
</html>